# PhalFNP
Analyses of the _Panicum hallii_ fast neutron mutagenesis population

Access the interactive depth images at the following link:
https://nolanbentley.github.io/PhalFNP/index.html

# Documenting the process
## Accessing the input files
These sequence mapping files and more originate from mapping reads to the _Panicum hallii_ V3.2 housed on the Phytozome (https://phytozome-next.jgi.doe.gov/info/Phallii_v3_2) database.

These files may be accessed via the JGI genome portal (https://genome.jgi.doe.gov/portal/ResaPanihallii/ResaPanihallii.info.html). 

This repo originally focused on the analysis of the bam files from this project (see data/bamFilesList.txt) as well as downstream variant files produced through the analysis of GATK and DELLY of collaborators. These downstream files are available upon request.

## Downloading the bam files
bam files were downloaded via JGI's curl-based API.

## Calculating copy number
bam files were then analyzed across a series of genomic intervals to calculate copy number using delly cnv. 

The commands to do this were generated by dellyCnvScriptGen.R and can be found in scripts/dellyCnv/.

## Determine loci to not include in later analyses
The resulting cov files were then analyzed in R using the script detectBadIntervals.R. This analysis loaded each file of CN values, detected intervals where calculated CN was more than 0.5 away from diploid across all samples. It then used this compiled information to find intervals detected to aberrant CN values in more than 5% of the samples and generate a data.frame of intervals to avoid in subsequent steps: data/highlyDivergentCNLoci.csv

##  Produce plots visualizing copy-number variants
The script makePlots.R was then used to analyze each cov file, remove intervals within 2500 base pairs of a loci listed in data/highlyDivergentCNLoci.csv, and finally summarize the median read depth across 7 adjacent intervals (spanning >=70K bp). It then produced a series of ggplot2 -> plotly -> htmlwidget derived interactive html files that visualize the windowed copy number analysis for easy exploration. The current URL to visualize the results of this is at  https://nolanbentley.github.io/PhalFNP/index.html 

## Produce html files to facilitate access to interative plots
The buildWebsiteIndex.R script then finally used to produce a series of html files that link together the various plots into an easy to explore format. 






