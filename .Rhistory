depthVec  <- sort(unlist(as.vector(sapply(byLenText,function(x){file.path(wd,"depths",paste0(trimmedBam,"_",x,"int.depth.out"))}))))
depthVec
trimmedBam <- gsub("\\.bam","",bamVec)
#Create filenames
currStep  <- 1
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",currStep,"of",1:steps)
bedName   <- file.path(wd,"bed",paste0("regions_",byLenText,".bed"))
depthVec  <- sort(unlist(as.vector(sapply(byLenText,function(x){file.path(wd,"depths",paste0(trimmedBam,"_",x,"int.depth.out"))}))))
#Remove files with the files already extant
bamVec <- bamVec[!file.exists(depthVec)]
depthVec
wd
depthPath <- "./data_ignored/secondary/depths/"
depthVec  <- sort(unlist(as.vector(sapply(byLenText,function(x){file.path(wd,depthPath,paste0(trimmedBam,"_",x,"int.depth.out"))}))))
depthVec
depthPath <- "./data_ignored/secondary/depths"
depthVec  <- sort(unlist(as.vector(sapply(byLenText,function(x){file.path(wd,depthPath,paste0(trimmedBam,"_",x,"int.depth.out"))}))))
depthVec
bamPath <- "data_ignored/primary/bam"
depthPath <- "data_ignored/secondary/depths"
wd    <-"~/Experiments/PhalFNP"
bamPath <- "data_ignored/primary/bam"
depthPath <- "data_ignored/secondary/depths"
fastaPath <- "data_ignored/primary/assembly/phal_assemblyV3.fasta"
byLen <- 20000
startPos <- 2000
regionWidth <- 5000
steps       <- 5
#Setup packages
packageDir <- file.path(wd,"R")
packageVec <- c("ggplot2","chron","data.table")
library(Biostrings) #Installation somewhat tricky
#Use paths
setwd(wd)
dir.create("bed"     ,showWarnings = F)
dir.create("depths"  ,showWarnings = F)
dir.create(packageDir,showWarnings = F)
.libPaths(packageDir)
if(!all(packageVec%in%installed.packages())){install.packages(packageVec,lib=packageDir, repos='http://cran.us.r-project.org')}
library("chron")
#Describe genome
ref <- Biostrings::readDNAStringSet(fastaPath)
initDf <- data.frame(
chr=names(ref),
max=nchar(ref)
)
#Find bam files
bamVec<-list.files(bamPath,pattern = "bam$",full.names = T)
trimmedBam <- gsub("\\.bam","",bamVec)
#Create filenames
currStep  <- 1
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",currStep,"of",1:steps)
bedName   <- file.path(wd,"bed",paste0("regions_",byLenText,".bed"))
depthVec  <- sort(unlist(as.vector(sapply(byLenText,function(x){file.path(wd,depthPath,paste0(trimmedBam,"_",x,"int.depth.out"))}))))
depthVec
dpethVecFun <- function(x){
file.path(wd,depthPath,paste0(trimmedBam,"_",x,"int.depth.out"))
}
#Setup variables
wd    <-"~/Experiments/PhalFNP"
bamPath <- "data_ignored/primary/bam"
depthPath <- "data_ignored/secondary/depths"
fastaPath <- "data_ignored/primary/assembly/phal_assemblyV3.fasta"
byLen <- 20000
startPos <- 2000
regionWidth <- 5000
steps       <- 5
#Setup packages
packageDir <- file.path(wd,"R")
packageVec <- c("ggplot2","chron","data.table")
library(Biostrings) #Installation somewhat tricky
#Use paths
setwd(wd)
dir.create("bed"     ,showWarnings = F)
dir.create("depths"  ,showWarnings = F)
dir.create(packageDir,showWarnings = F)
.libPaths(packageDir)
if(!all(packageVec%in%installed.packages())){install.packages(packageVec,lib=packageDir, repos='http://cran.us.r-project.org')}
library("chron")
#Describe genome
ref <- Biostrings::readDNAStringSet(fastaPath)
initDf <- data.frame(
chr=names(ref),
max=nchar(ref)
)
#Find bam files
bamVec<-list.files(bamPath,pattern = "bam$",full.names = T)
trimmedBam <- gsub("\\.bam","",bamVec)
#Create filenames
currStep  <- 1
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",currStep,"of",1:steps)
bedName   <- file.path(wd,"bed",paste0("regions_",byLenText,".bed"))
depthVecFun <- function(x){file.path(wd,depthPath,paste0(trimmedBam,"_",x,"int.depth.out"))}
depthVec  <-sapply(X = byLenText,FUN = depthVecFun)
depthVec  <- sort(unlist(as.vector(depthVec)))
depthVecFun <- function(x){file.path(wd,depthPath,paste0(basename(trimmedBam),"_",x,"int.depth.out"))}
depthVec  <-sapply(X = byLenText,FUN = depthVecFun)
depthVec  <- sort(unlist(as.vector(depthVec)))
depthVec
#Remove files with the files already extant
bamVec <- bamVec[!file.exists(depthVec)]
bamVec_infor <- bamVec_infor[!file.exists(depthVec),]
bamVec
bamVec
depthVec
byLenText
fileDf <- data.frame(bam = bamVec)
fileDf
#Setup variables
wd    <-"~/Experiments/PhalFNP"
bamPath <- "data_ignored/primary/bam"
depthPath <- "data_ignored/secondary/depths"
fastaPath <- "data_ignored/primary/assembly/phal_assemblyV3.fasta"
byLen <- 20000
startPos <- 2000
regionWidth <- 5000
steps       <- 5
#Setup packages
packageDir <- file.path(wd,"R")
packageVec <- c("ggplot2","chron","data.table")
library(Biostrings) #Installation somewhat tricky
#Use paths
setwd(wd)
dir.create("bed"     ,showWarnings = F)
dir.create("depths"  ,showWarnings = F)
dir.create(packageDir,showWarnings = F)
.libPaths(packageDir)
if(!all(packageVec%in%installed.packages())){install.packages(packageVec,lib=packageDir, repos='http://cran.us.r-project.org')}
library("chron")
#Describe genome
ref <- Biostrings::readDNAStringSet(fastaPath)
initDf <- data.frame(
chr=names(ref),
max=nchar(ref)
)
#Find bam files
bamVec<-list.files(bamPath,pattern = "bam$",full.names = T)
trimmedBam <- gsub("\\.bam","",bamVec)
#Create filenames
currStep  <- 1
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",currStep,"of",1:steps)
bedName   <- file.path(wd,"bed",paste0("regions_",byLenText,".bed"))
fileDf <- data.frame(bam = bamVec)
fileDf
file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
for(i in 1:length(byLenText)){
fileDf[[i]]<-file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
}
fileDf
dim(fileDf)
fileDf$V2
tail(fileDf$V2)
data.frame(bam = fileDf$bam,depth=as.vector(unlist(fileDf[,2:ncol(fileDf)])))
fileDf <- data.frame(bam = fileDf$bam,depth=as.vector(unlist(fileDf[,2:ncol(fileDf)])))
head(fileDf)
tail(fileDf)
#Create filenames
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,1:steps,"of",steps)
byLenText
1:steps
#Create filenames
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,,"_",1:steps,"of",steps)
#Create filenames
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,,"Kwide_",1:steps,"of",steps)
byLenText
#Create filenames
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,,"Kwide_",1:steps,"of",steps)
#Create filenames
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",1:steps,"of",steps)
byLenText
#Create filenames
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",1:steps,"of",steps)
bedName   <- file.path(wd,"bed",paste0("regions_",byLenText,".bed"))
fileDf <- data.frame(bam = bamVec)
fileDf
for(i in 1:length(byLenText)){
fileDf[[i]]<-file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
}
fileDf <- data.frame(bam = fileDf$bam,depth=as.vector(unlist(fileDf[,2:ncol(fileDf)])))
tail(fileDf)
fileDf <- data.frame(bam = fileDf$bam,depth=as.vector(unlist(fileDf[,2:ncol(fileDf)])))
for(i in 1:length(byLenText)){
fileDf[[i]]<-file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
}
bamVec
fileDf <- data.frame(bam = bamVec)
for(i in 1:length(byLenText)){
fileDf[[i]]<-file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
}
fileDf
fileDf$bam
dim(fileDf$bam)
fileDf <- data.frame(bam = bamVec)
for(i in 1:length(byLenText)){
fileDf[[i+1]]<-file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
}
fileDf <- data.frame(bam = fileDf$bam,depth=as.vector(unlist(fileDf[,2:ncol(fileDf)])))
tail(fileDf)
head(fileDf)
gsub(".*FIL","",bamVec)
gsub("_.*","",gsub(".*FIL","",bamVec))
gsub("_.*","",gsub("^.._","",gsub(".*FIL","",bamVec)))
bamVec<-bamVec[order(as.numeric(gsub("_.*","",gsub("^.._","",gsub(".*FIL","",bamVec)))))]
bamVec
bamVec<-bamVec[order(as.numeric(gsub("_.*","",gsub("^.._","",gsub(".*FIL","",bamVec)))))]
trimmedBam <- gsub("\\.bam","",bamVec)
#Summarize fbam files analyzed
write(bamVec,"data/listOfBamFilesInDepth.txt")
#Summarize fbam files analyzed
write(bamVec,"data/listOfBamFilesInDepth.txt")
#Create filenames
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",1:steps,"of",steps)
bedName   <- file.path(wd,"bed",paste0("regions_",byLenText,".bed"))
fileDf <- data.frame(bam = bamVec)
for(i in 1:length(byLenText)){
fileDf[[i+1]]<-file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
}
fileDf <- data.frame(bam = fileDf$bam,depth=as.vector(unlist(fileDf[,2:ncol(fileDf)])))
head(fileDf)
tail(fileDf)
#Remove files with the files already extant
bamVec   <- fileDf$bam[!file.exists(fileDf$depth)]
depthVec <- fileDf$depth[!file.exists(fileDf$depth)]
depthVec
bamVec
#Setup variables
wd    <-"~/Experiments/PhalFNP"
bamPath <- "data_ignored/primary/bam"
depthPath <- "data_ignored/secondary/depths"
fastaPath <- "data_ignored/primary/assembly/phal_assemblyV3.fasta"
byLen <- 20000
startPos <- 2000
regionWidth <- 5000
steps       <- 5
#Setup packages
packageDir <- file.path(wd,"R")
packageVec <- c("ggplot2","chron","data.table")
library(Biostrings) #Installation somewhat tricky
#Use paths
setwd(wd)
dir.create("bed"     ,showWarnings = F)
dir.create("depths"  ,showWarnings = F)
dir.create(packageDir,showWarnings = F)
.libPaths(packageDir)
if(!all(packageVec%in%installed.packages())){install.packages(packageVec,lib=packageDir, repos='http://cran.us.r-project.org')}
library("chron")
#Describe genome
ref <- Biostrings::readDNAStringSet(fastaPath)
initDf <- data.frame(
chr=names(ref),
max=nchar(ref)
)
#Find bam files
bamVec<-list.files(bamPath,pattern = "bam$",full.names = T)
bamVec<-bamVec[order(as.numeric(gsub("_.*","",gsub("^.._","",gsub(".*FIL","",bamVec)))))]
trimmedBam <- gsub("\\.bam","",bamVec)
#Summarize fbam files analyzed
write(bamVec,"data/listOfBamFilesInDepth.txt")
#Create filenames
byLenText <- paste0(startPos/1000,"Kstart_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",1:steps,"of",steps)
bedName   <- file.path(wd,"bed",paste0("regions_",byLenText,".bed"))
fileDf <- data.frame(bam = bamVec)
for(i in 1:length(byLenText)){
fileDf[[i+1]]<-file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
}
fileDf <- data.frame(bam = fileDf$bam,depth=as.vector(unlist(fileDf[,2:ncol(fileDf)])))
tail(fileDf)
#Remove files with the files already extant
bamVec   <- fileDf$bam[!file.exists(fileDf$depth)]
depthVec <- fileDf$depth[!file.exists(fileDf$depth)]
depthVec
bamVec
depthVec
nrow(initDf)
currDf <- data.frame(
chr=initDf$chr[i],
min=seq(startPos,initDf[i,2],by=byLen),
max=seq(startPos,initDf[i,2],by=byLen)+regionWidth
)
currDf
#Generate bed files
for(i in 1:nrow(initDf)){
currDf <- data.frame(
chr=initDf$chr[i],
min=seq(startPos,initDf[i,2],by=byLen),
max=seq(startPos,initDf[i,2],by=byLen)+regionWidth
)
if(i==1){
outDf<-currDf
}else{
outDf<-rbind(outDf,currDf)
}
}
byLen
regionWidth
byLen*step
byLen*steps
#Generate bed files
for(i in 1:nrow(initDf)){
currDf <- data.frame(
chr=initDf$chr[i],
min=seq(startPos,initDf[i,2],by=byLen),
max=seq(startPos,initDf[i,2],by=byLen)+regionWidth
)
if(i==1){
outDf<-currDf
}else{
outDf<-rbind(outDf,currDf)
}
}
outDf
outDf_split<-outDf
rep(1:steps,nrow(outDf_split))
byLen
initDf[i,2]
initDf[i,2]
startPos
startPos
regionWidth
#Generate bed files
for(i in 1:nrow(initDf)){
currDf <- data.frame(
chr=initDf$chr[i],
min=seq(startPos,initDf[i,2]-startPos,by=byLen),
max=seq(startPos,initDf[i,2]-startPos,by=byLen)+regionWidth
)
if(i==1){
outDf<-currDf
}else{
outDf<-rbind(outDf,currDf)
}
}
outDf_split<-outDf
ceiling(nrow(outDf_split)/steps))
ceiling(nrow(outDf_split)/steps)
outDf_split$step <- rep(1:steps,ceiling(nrow(outDf_split)/steps))
outDf_split$step <- rep(1:steps,ceiling(nrow(outDf_split)/steps))[1:nrow(outDf_split)]
outDf_split$step
table(outDf_split$step)
bedName
stepVec <- rep(1:steps,ceiling(nrow(outDf_split)/steps))[1:nrow(outDf_split)]
stepVec
i
for(i in 1:length(bedName)){
write.table(outDf[stepVec==i,],file = bedName[i],row.names = F,col.names = F,quote = F)
}
bedName
bedPath <- "data_ignored/secondary/bed"
bedName   <- file.path(wd,bedPath,"bed",paste0("regions_",byLenText,".bed"))
bedName
bedName   <- file.path(wd,bedPath,paste0("regions_",byLenText,".bed"))
bedName
for(i in 1:length(bedName)){
write.table(outDf[stepVec==i,],file = bedName[i],row.names = F,col.names = F,quote = F)
}
#Setup variables
wd    <-"~/Experiments/PhalFNP"
bamPath <- "data_ignored/primary/bam"
bedPath <- "data_ignored/secondary/bed"
depthPath <- "data_ignored/secondary/depths"
fastaPath <- "data_ignored/primary/assembly/phal_assemblyV3.fasta"
byLen <- 20000
buffer <- 2000
regionWidth <- 5000
steps       <- 5
#Setup packages
packageDir <- file.path(wd,"R")
packageVec <- c("ggplot2","chron","data.table")
library(Biostrings) #Installation somewhat tricky
#Use paths
setwd(wd)
dir.create("bed"     ,showWarnings = F)
dir.create("depths"  ,showWarnings = F)
dir.create(packageDir,showWarnings = F)
.libPaths(packageDir)
if(!all(packageVec%in%installed.packages())){install.packages(packageVec,lib=packageDir, repos='http://cran.us.r-project.org')}
library("chron")
#Describe genome
ref <- Biostrings::readDNAStringSet(fastaPath)
initDf <- data.frame(
chr=names(ref),
max=nchar(ref)
)
#Find bam files
bamVec<-list.files(bamPath,pattern = "bam$",full.names = T)
bamVec<-bamVec[order(as.numeric(gsub("_.*","",gsub("^.._","",gsub(".*FIL","",bamVec)))))]
trimmedBam <- gsub("\\.bam","",bamVec)
#Summarize fbam files analyzed
write(bamVec,"data/listOfBamFilesInDepth.txt")
#Create filenames
byLenText <- paste0(buffer/1000,"Kbuffer_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",1:steps,"of",steps)
bedName   <- file.path(wd,bedPath,paste0("regions_",byLenText,".bed"))
fileDf <- data.frame(bam = bamVec)
for(i in 1:length(byLenText)){
fileDf[[i+1]]<-file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
}
fileDf <- data.frame(bam = fileDf$bam,depth=as.vector(unlist(fileDf[,2:ncol(fileDf)])))
tail(fileDf)
#Remove files with the files already extant
bamVec   <- fileDf$bam[!file.exists(fileDf$depth)]
depthVec <- fileDf$depth[!file.exists(fileDf$depth)]
#Generate bed files
for(i in 1:nrow(initDf)){
currDf <- data.frame(
chr=initDf$chr[i],
min=seq(buffer,initDf[i,2]-buffer,by=byLen),
max=seq(buffer,initDf[i,2]-buffer,by=byLen)+regionWidth
)
if(i==1){
outDf<-currDf
}else{
outDf<-rbind(outDf,currDf)
}
}
outDf_split<-outDf
stepVec <- rep(1:steps,ceiling(nrow(outDf_split)/steps))[1:nrow(outDf_split)]
for(i in 1:length(bedName)){
write.table(outDf[stepVec==i,],file = bedName[i],row.names = F,col.names = F,quote = F)
}
#Setup variables
wd    <-"~/Experiments/PhalFNP"
bamPath <- "data_ignored/primary/bam"
bedPath <- "data_ignored/secondary/bed"
depthPath <- "data_ignored/secondary/depths"
fastaPath <- "data_ignored/primary/assembly/phal_assemblyV3.fasta"
byLen <- 20000
buffer <- 2000
regionWidth <- 5000
steps       <- 5
#Setup packages
packageDir <- file.path(wd,"R")
packageVec <- c("ggplot2","chron","data.table")
library(Biostrings) #Installation somewhat tricky
#Use paths
setwd(wd)
dir.create("bed"     ,showWarnings = F)
dir.create("depths"  ,showWarnings = F)
dir.create(packageDir,showWarnings = F)
.libPaths(packageDir)
if(!all(packageVec%in%installed.packages())){install.packages(packageVec,lib=packageDir, repos='http://cran.us.r-project.org')}
library("chron")
#Describe genome
ref <- Biostrings::readDNAStringSet(fastaPath)
initDf <- data.frame(
chr=names(ref),
max=nchar(ref)
)
#Find bam files
bamVec<-list.files(bamPath,pattern = "bam$",full.names = T)
bamVec<-bamVec[order(as.numeric(gsub("_.*","",gsub("^.._","",gsub(".*FIL","",bamVec)))))]
trimmedBam <- gsub("\\.bam","",bamVec)
#Summarize fbam files analyzed
write(bamVec,"data/listOfBamFilesInDepth.txt")
#Create filenames
byLenText <- paste0(buffer/1000,"Kbuffer_",byLen/1000,"Kint_",regionWidth/1000,"Kwide_",1:steps,"of",steps)
bedName   <- file.path(wd,bedPath,paste0("regions_",byLenText,".bed"))
fileDf <- data.frame(bam = bamVec)
for(i in 1:length(byLenText)){
fileDf[[i+1]]<-file.path(wd,depthPath,paste0(basename(trimmedBam),"_",byLenText[i],"int.depth.out"))
}
fileDf <- data.frame(bam = fileDf$bam,depth=as.vector(unlist(fileDf[,2:ncol(fileDf)])))
tail(fileDf)
#Remove files with the files already extant
bamVec   <- fileDf$bam[!file.exists(fileDf$depth)]
depthVec <- fileDf$depth[!file.exists(fileDf$depth)]
#Generate bed files
for(i in 1:nrow(initDf)){
currDf <- data.frame(
chr=initDf$chr[i],
min=seq(buffer,initDf[i,2]-buffer,by=byLen),
max=seq(buffer,initDf[i,2]-buffer,by=byLen)+regionWidth
)
if(i==1){
outDf<-currDf
}else{
outDf<-rbind(outDf,currDf)
}
}
outDf_split<-outDf
stepVec <- rep(1:steps,ceiling(nrow(outDf_split)/steps))[1:nrow(outDf_split)]
for(i in 1:length(bedName)){
write.table(outDf[stepVec==i,],file = bedName[i],row.names = F,col.names = F,quote = F)
}
if(i==1){outDf<-currDf
}else{outDf<-rbind(outDf,currDf)}
#Generate bed files
for(i in 1:nrow(initDf)){
currDf <- data.frame(chr=initDf$chr[i],min=seq(buffer,initDf[i,2]-buffer,by=byLen),
max=seq(buffer,initDf[i,2]-buffer,by=byLen)+regionWidth)
if(i==1){outDf<-currDf
}else{outDf<-rbind(outDf,currDf)}
}
outDf
#Generate bed files
for(i in 1:nrow(initDf)){
currDf <- data.frame(chr=initDf$chr[i],min=seq(buffer,initDf[i,2]-buffer,by=byLen),
max=seq(buffer,initDf[i,2]-buffer,by=byLen)+regionWidth)
if(i==1){outDf<-currDf
}else{outDf<-rbind(outDf,currDf)}
}
outDf_split<-outDf
stepVec <- rep(1:steps,ceiling(nrow(outDf_split)/steps))[1:nrow(outDf_split)]
for(i in 1:length(bedName)){
write.table(outDf[stepVec==i,],file = bedName[i],row.names = F,col.names = F,quote = F)
}
library(parallel)
currCode <- paste0(
"cd ~/../SharedUser/FastNeutron/alignments/; ",
"samtools depth -b ",bedName," ", bamVec," > ",
depthVec
)
currCode
